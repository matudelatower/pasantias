{% extends 'ThemeBundle:Default:base.html.twig' %}
{% block contenido %}
<link href="{{asset('public/css/curriculum.css')}}" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="{{asset('public/js/curvycorners.src.js')}}"></script>


<script type="text/javascript">//<![CDATA[
    var selectedTab = 0;

    function tabclick(n) {
        if (n === selectedTab)
            return; // nothing to do.
        curvyCorners.setWinResize(false); // for IE, block spurious window resize events 
        var li = document.getElementById('tab' + selectedTab);
        curvyCorners.adjust(li, 'className', ''); // Remove the 'select' style
        li = document.getElementById('page' + selectedTab);
        li.style.display = 'none';                // hide the currently selected sub-page
        li = document.getElementById('page' + n);
        li.style.display = 'block';               // show the new sub-page
        li = document.getElementById('tab' + n);  // get the new (clicked) tab
        curvyCorners.adjust(li, 'className', 'select'); // and update its style
        curvyCorners.redraw();        // Redraw all elements with className curvyRedraw
        selectedTab = n;              // store for future reference
        curvyCorners.setWinResize(true); // OK, allow genuine resize events now
    }

    curvyCorners.addEvent(window, 'resize', new Function('curvyCorners.handleWinResize();'));
//]]>
    </script>

    <h1>Carga de Curriculum</h1>

    <form action="{{ path('curriculum_create') }}" method="post" {{ form_enctype(form) }}>
    {#{{ form_widget(form) }}#}
            <div id="tabrow">
                <ul>
                    <li id="tab0" onclick="tabclick(0);" class="select curvyRedraw">Datos Personales</li>
                    <li id="tab1" onclick="tabclick(1);" class="curvyRedraw">Formación Académica</li>
                    <li id="tab2" onclick="tabclick(2);" class="curvyRedraw">Conocimientos</li>
                    <li id="tab3" onclick="tabclick(3);" class="curvyRedraw">Antecedentes Laborales</li>
                        {#<li id="tab4" onclick="tabclick(4);" class="curvyRedraw">Congresos/Jornadas</li>
                        <!--<li id="tab5" onclick="tabclick(5);" class="curvyRedraw">Cursos Realizados</li>
                        <li id="tab6" onclick="tabclick(6);" class="curvyRedraw">Investigaci&oacute;n</li>
                        <li id="tab7" onclick="tabclick(7);" class="curvyRedraw">Otros Datos</li>
                        <!--<li id="tab8" onclick="tabclick(8);" class="curvyRedraw">Tab 63</li>-->#}
                    </ul>
                </div>

                <div id="midbox" class="curvyRedraw">

                    <!-- Primera pesta�a -->
                    <div id="page0" class="subpage">

                        <h3>Datos de la Persona</h3>
        {{ form_row(form.persona.nombre) }}
        {{ form_row(form.persona.apellido) }}
        {{ form_row(form.persona.dni) }}
        {{ form_row(form.persona.cuit) }}
        {{ form_row(form.persona.fechaNacimiento) }}
        {{ form_row(form.persona.file) }}

                        <h3>Domicilio</h3>
                        <ul class="domicilio" data-prototype="{{ form_widget(form.persona.domicilio.vars.prototype)|e }}">
        {# itera sobre cada etiqueta existente y reproduce su único campo: name #}
        {% for domicilios in form.persona.domicilio %}
                                <li>{{ form_row(domicilios.calle) }}</li>
                                <li>{{ form_row(domicilios.numero) }}</li>
                                <li>{{ form_row(domicilios.depto) }}</li>
                                <li>{{ form_row(domicilios.piso) }}</li>
                                <li>{{ form_row(domicilios.provincias) }}</li>
                                <li>{{ form_row(domicilios.localidad) }}</li>
        {% endfor %}
                                </ul>
                            </div>

                            <!-- Segunda pesta�a -->
                            <div id="page1" class="subpage" style="display:none">
                                <h3>Datos Academicos</h3>
                                <ul class="datos_academicos" data-prototype="{{ form_widget(form.persona.formacionAcademica.vars.prototype)|e }}">
        {# itera sobre cada etiqueta existente y reproduce su único campo: name #}
        {% for dato_academico in form.persona.formacionAcademica %}
                                        <li>{{ form_row(dato_academico.ingreso) }}</li>
                                        <li>{{ form_row(dato_academico.egreso) }}</li>
                                        <li>{{ form_row(dato_academico.estadoavance) }}</li>
                                        <li>{{ form_row(dato_academico.carrera) }}</li>
                                        

        {% endfor %}
                                    </ul>
                                </div>

                                <!-- Tercera pesta�a -->
                                <div id="page2" class="subpage" style="display:none">
                                    <h3>Conocimientos</h3>
                                    <ul class="conocimientos" data-prototype="{{ form_widget(form.persona.conocimientos.vars.prototype)|e }}">
                    {# itera sobre cada etiqueta existente y reproduce su único campo: name #}
                    {% for conocimiento in form.persona.conocimientos %}
                                            <li>{{ form_row(conocimiento.subarea) }}</li>
                                            <li>{{ form_row(conocimiento.campo) }}</li>
                                            <li>{{ form_row(conocimiento.nivel) }}</li>


                    {% endfor %}
                                        </ul>


                                    </div>

                                    <!-- Cuarta pesta�a -->
                                    <div id="page3" class="subpage" style="display:none">
                                        <h3>Antecedentes laborales</h3>
                                        <ul class="antecedentes_laborales" data-prototype="{{ form_widget(form.persona.antecedente_laboral.vars.prototype)|e }}">
        {# itera sobre cada etiqueta existente y reproduce su único campo: name #}
        {% for antecedentes_laborales in form.persona.antecedente_laboral %}
                                                <li>{{ form_row(antecedente_laboral.empresa) }}</li>
                                                <li>{{ form_row(conocimiento.fechadesde) }}</li>
                                                <li>{{ form_row(conocimiento.fechahasta) }}</li>
                                                <li>{{ form_row(conocimiento.descripcion) }}</li>
                                                <li>{{ form_row(conocimiento.nombrecontacto) }}</li>
                                                <li>{{ form_row(conocimiento.telcontacto) }}</li>


        {% endfor %}
                                            </ul>     
                                        </div>
        {#{{ form_rest(form) }}#}


                                    </div>



                                    <script type="text/javascript" src="{{asset('public/js/jQuery.min.js')}}"></script>
                                    <script>
    // Obtiene el div que contiene la colección de etiquetas
//var collectionHolder = $('#content_data ul');
    var domicilioCount = 0;
    $('#midbox ul').each(function(i, e) {
        var collectionHolder = $(e);

        // configura una enlace "Agregar una etiqueta"
        var $addTagLink = $('<a href="#" class="add_link">Agregar</a>');
        var $newLinkLi = $('<li></li>').append($addTagLink);



        jQuery(document).ready(function() {
            collectionHolder.find('li').each(function() {
                addTagFormDeleteLink($(this));
            });

            // Añade el ancla "Agregar una etiqueta" y las etiquetas li y ul
            collectionHolder.append($newLinkLi);

            $addTagLink.on('click', function(e) {
                // evita crear el enlace con una "#" en la URL
                e.preventDefault();

                // añade una nueva etiqueta form (ve el siguiente bloque de código)
                addTagForm(collectionHolder, $newLinkLi);
            });
        });

    });
    function addTagForm(collectionHolder, $newLinkLi) {
        if (collectionHolder.attr('class') == 'domicilio') {
            domicilioCount++;
            if (domicilioCount > 2) {
                return false;
            }
        }

        // Obtiene el data-prototype explicado anteriormente
        var prototype = collectionHolder.attr('data-prototype');

        // cuenta las entradas actuales en el formulario (p. ej. 2),
        // lo usa como el nuevo índice (p. ej. 2)
        var newIndex = collectionHolder.find(':input').length;


        // Reemplaza el '__name__' en el prototipo HTML para que
        // en su lugar sea un número basado en cuántos elementos hay
        var newForm = prototype.replace(/__name__/g, newIndex);

        // Muestra el formulario en la página en un elemento li,
        // antes del enlace 'Agregar una etiqueta'
        var $newFormLi = $('<li></li>').append(newForm);
        $newLinkLi.before($newFormLi);

        addTagFormDeleteLink($newFormLi);
    }

    function addTagFormDeleteLink($tagFormLi) {
        var $removeFormA = $('<a href="#" class="close">Eliminar</a>');
        $tagFormLi.append($removeFormA);

        $removeFormA.on('click', function(e) {
            // evita crear el enlace con una "#" en la URL
            e.preventDefault();

            // quita el li de la etiqueta del formulario
            $tagFormLi.remove();


            domicilioCount--;


        });
    }



    $(document).on('change', '.province_selector', function() {
        var $this = $(this);
        var data = {
            province_id: $this.val()
        };

        $.ajax({
            type: 'post',
            url: '{{ path("select_localidades") }}',
            data: data,
            success: function(data) {
                var $address = $this.closest('.domicilio');
                $address.find('.city_selector').html(data);
            }
        });
    });

    $(document).on('change', '.area_selector', function() {
        var $this = $(this);

        var data = {
            area_id: $this.val(),
        };

        $.ajax({
            type: 'post',
            url: '{{ path("select_subareas") }}',
            data: data,
            success: function(data) {

                var $address = $this.closest('.conocimientos');
                $address.find('.subArea_selector').html(data);
            }
        });
    });

    /*$(document).on('click', '.close', function() {
     $(this).closest('.domicilio').fadeOut(500, function() {
     alert("hola");
     $(this).remove();
     });
     });*/
                                        </script>

                                        <p>
                                            <button type="submit">Create</button>
                                        </p>
                                    </form>

                                    <ul class="record_actions">
                                        <li>
                                            <a href="{{ path('curriculum_homepage') }}">
                                                Back to the list
                                            </a>
                                        </li>
                                    </ul>
{%endblock%}
